(()=>{"use strict";const t=class{constructor(){}queryStringData(t){return[...t.entries()].map((t=>`${encodeURIComponent(t[0])}=${encodeURIComponent(t[1])}`)).join("&")}async post(t=null){if(!t||null==t)return;const e=t.action,s=t.url,o=t.data,n=o?this.queryStringData(o):null;if(null==n)return;const r=new XMLHttpRequest;return new Promise(((t,o)=>{r.open("POST",`${s}?action=${e}`,!0),r.setRequestHeader("Access-Control-Allow-Headers","*"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.addEventListener("readystatechange",(function(){this.readyState===XMLHttpRequest.DONE&&(this.status<300?t(this.responseText):o(this.statusText))})),r.send(n)}))}},e=class extends t{constructor({nonceID:t="ad-survey-manage-nonce",urlClass:e="adsurvery__manage__wrapper__url",ajaxAction:s="ad_survey_manage_delete",shortCodeBttnClass:o="--copy-bttn",deleteSurveyBttnClass:n="--delete-bttn",responseArea:r="--survey-response",loadingClass:i="--survey-loading",copiedClass:a="--survey-copied",errorClass:d="--survey-error"}={}){super(),this.errorMsg="There are no more surveys left. Please re-import your survey questions and try again.",this.url=document.querySelector(`.${e}`),this.nonce=document.querySelector(`#${t}`),this.deleteBttn=document.querySelectorAll(`.${n}`),this.shortCodeBttn=document.querySelectorAll(`.${o}`),this.response=document.querySelector(`.${r}`),this.loading=i,this.copied=a,this.action=s,this.error=d,this.timers=[],this.delay=.7,this.events()}events(){this.deleteBttn.forEach((t=>{t.addEventListener("touchstart",this.deleted.bind(this))})),this.deleteBttn.forEach((t=>{t.addEventListener("click",this.deleted.bind(this))})),this.shortCodeBttn.forEach((t=>{t.addEventListener("touchstart",this.shortcode.bind(this))})),this.shortCodeBttn.forEach((t=>{t.addEventListener("click",this.shortcode.bind(this))}))}deleted(t){t.preventDefault();const e=t.target,s=e.parentNode.parentNode,o={},n=new FormData;e.classList.add(this.loading),o.action=this.action,o.url=this.url&&this.url.value?this.url.value:null,n.append("survey",e&&e.parentNode&&e.parentNode.dataset.num?e.parentNode.dataset.num:null),n.append("nonce",this.nonce&&this.nonce.value?this.nonce.value:null),o.data=n,this.post(o).then((t=>{const o=JSON.parse(t);o.success&&this.response&&(this.removeSurveyRow(s),this.displayMessage(o.success)),o.error&&this.displayMessage(o.error,!0),e.classList.remove(this.loading)}),(t=>{console.error("ERROR:",t),e.classList.remove(this.loading)}))}shortcode(t){t.preventDefault();const e=t.target,s=`[${e.parentNode.dataset.num}]`;e.classList.add(this.copied),this.delayIconRemoval(e,this.copied),this.copyShortCode(s)}copyShortCode(t=null){null!=t&&(navigator.clipboard?navigator.clipboard.writeText(t).then((function(){console.log("[Navigator] Copied shortcode to clipboard:",t)}),(function(t){console.error("[Navigator] Could not copy text:",t)})):this.legacyCopyText(t))}legacyCopyText(t){const e=document.createElement("textarea").style.display="none";e.value=t,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),console.log("[Legacy] Copied shortcode to clipboard:",t)}catch(t){console.error("[Legacy] Could not copy shortcode to clipboard:",t)}document.body.removeChild(e)}removeSurveyRow(t=null){if(null===t)return;const e=t.parentNode;t.remove();const s=e.parentNode;if(e.querySelectorAll("li").length<=0){e.remove();const t=document.createElement("p");t.classList.add(this.error),t.textContent=this.errorMsg,s.appendChild(t)}}delayIconRemoval(t=null,e=null){if(null==t||null==e)return;const s=this,o=Date.now().toString(36)+Math.random().toString(36).substring(2,12).padStart(12,0);s.timers[o]=setTimeout((function(){t.classList.remove(e),s.timers[o]&&delete s.timers[o]}),1e3*s.delay)}displayMessage(t=null,e=!1){if(null===t)return;this.response.replaceChildren();const s=document.createElement("div"),o=document.createElement("p");return e?s.classList.add("notice","notice-error","is-dismissible"):s.classList.add("notice","notice-success","is-dismissible"),o.textContent=t,s.appendChild(o),this.response.appendChild(s)}},s=class{constructor({exportFormButton:t="adsurvery__export__wrapper__form__submit > input[type='submit']",importFormButton:e="adsurvery__import__wrapper__form__submit > input[type='submit']",loadingClass:s="--admin-survey-loading"}={}){this.exportBttn=document.querySelector(`.${t}`),this.importBttn=document.querySelector(`.${e}`),this.loading=s,this.timer=null,this.delay=1.9,this.events()}events(){this.exportBttn&&this.exportBttn.addEventListener("touchstart",this.exportProcess.bind(this)),this.exportBttn&&this.exportBttn.addEventListener("click",this.exportProcess.bind(this)),this.importBttn&&this.importBttn.addEventListener("touchstart",this.addLoadingIcon.bind(this)),this.importBttn&&this.importBttn.addEventListener("click",this.addLoadingIcon.bind(this))}exportProcess(t){const e=t.target,s=this;e.classList.add(s.loading),clearTimeout(s.time),s.time=setTimeout((function(){s.exportBttn.classList.remove(s.loading)}),1e3*s.delay)}addLoadingIcon(t){t.target.classList.add(this.loading)}};var o;o=()=>{new e,new s},"loading"!=document.readyState?o():document.addEventListener?document.addEventListener("DOMContentLoaded",o):document.attachEvent("onreadystatechange",(function(){"complete"==document.readyState&&o()}))})();
//# sourceMappingURL=admin.js.map